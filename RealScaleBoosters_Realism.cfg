// WARNING
// WARNING - Incomplete config. Don't enable unless you REALLY know what you're doing.
// WARNING


// Patches for RealismOverhaul, RealFuels, ModularFuelTanks, etc.
// May not be necessary, with other folks contributing patches to those mods. 


// Fuel tanks will need very specific rules, but for the meoment, follow the stock-alike bulk update rule:
@PART[RSB*]:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],!MODULE[ModuleFuelTanks]]:NEEDS[RealFuels|RealismOverhaul|ModularFuelTanks]:FOR[RealScaleBoosters]
{
	// This is a default, based on how stock tanks are altered. May need tweaking per tank.

	%Vol = #$RESOURCE[LiquidFuel]/maxAmount$
	@Vol += #$RESOURCE[Oxidizer]/maxAmount$
	@Vol *= 5

	MODULE
	{
		name = ModuleFuelTanks
		volume = #$../Vol$
		type = Default
	}

	!Vol = 0
}

// Some tanks are specifically cryogenic. 
@PART[RSBtankSTSET|RSBtankAresIstage2|RSBinterstageAtlasCentaur*|RSBtankDeltaIVdcss*|RSBtankDeltaIVcore]:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],MODULE[ModuleFuelTanks]]]:FOR[RealScaleBoosters]
{
	// Execute after ModuleFuelTanks is added, and just change the type.

	@MODULE[ModuleFuelTanks]
	{
		@type = Cryogenic
	}
}

// Adjust everything that contains SolidFuel to use the new quantities/density from RealFuels.
// Ideally these should all be switched to more correct propellants however.
@PART[RSB*]:HAS[@RESOURCE[SolidFuel]]:NEEDS[RealFuels|RealismOverhaul]:FOR[RealScaleBoosters]
{
	@RESOURCE[SolidFuel]
	{
		@amount *= 4.213483
		@maxAmount *= 4.213483
	}
}

// Ariane SRB config from Felbourn:
@PART[RSBengineArianeVSRB]:NEEDS[RealFuels|RealismOverhaul]
{
	@RESOURCE[SolidFuel]
	{
		@amount = 134904
		@maxAmount = 134904
	}
	@MODULE[ModuleEnginesFX]
	{
		@name = ModuleEnginesRF	
	}
	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEnginesRF
		configuration = MPS 241
		CONFIG
		{
			name = MPS 236
			minThrust = 6650 // stats before year 2000
			maxThrust = 6650
			atmosphereCurve
			{
				key = 0 273.7
				key = 1 248.7
			}
		}
		CONFIG
		{
			name = MPS 238
			minThrust = 6709 // stats from 2000-2003
			maxThrust = 6709
			atmosphereCurve
			{
				key = 0 275.4
				key = 1 250.4
			}
		}
		CONFIG
		{
			name = MPS 241
			minThrust = 7080 // stats after 2003
			maxThrust = 7080
			atmosphereCurve
			{
				key = 0 278.0
				key = 1 253.0
			}
		}
	}	
	@MODULE[ModuleEngineConfigs]
	{
		@CONFIG,*
		{
			curveResource = SolidFuel
			thrustCurveUseTime = True
			thrustCurve
			{
				key =   0 0.70
				key =   3 0.89
				key =  12 1.00
				key =  31 0.70
				key =  43 0.60
				key =  61 0.75
				key =  66 0.70
				key =  99 0.86
				key = 102 0.85
				key = 125 0.06
				key = 135 0.01
			}
		}
	}
}

